<div class="dataset-container">
  <!-- List View -->
  @if (currentView === 'list') {
    <div class="dataset-list">
      <h2>
        Recent Datasets
        <button class="create-btn" (click)="showCreateForm()">
          <mat-icon>add</mat-icon> New
        </button>
      </h2>
      
      @if (loading) {
        <div class="loading">
          <p>Loading datasets...</p>
        </div>
      }
      
      @if (error) {
        <div class="error">
          <p>{{ error }}</p>
        </div>
      }
      
      @if (!loading && datasets && datasets.length > 0) {
        <ul>
          @for (dataset of datasets; track dataset.dataSetId) {
            <li (click)="selectDataset(dataset)" 
                [class.selected]="selectedDataset?.dataSetId === dataset.dataSetId">
              <strong>{{ dataset.dataSetTitle }}</strong>
              <small>Created: {{ formatDate(dataset.createdAt) }}</small>
              <div class="source-badge">{{ getSourceFlagLabel(dataset.sourceType) }}</div>
            </li>
          }
        </ul>
      }
      
      @if (!loading && (!datasets || datasets.length === 0)) {
        <div class="empty-state">
          <p>No datasets found.</p>
        </div>
      }
    </div>
  }

  <!-- Detail View -->
  @if (currentView === 'detail' && selectedDataset) {
    <div class="dataset-details">
      <h2>{{ selectedDataset.dataSetTitle }}</h2>
      
      @if (selectedDataset.description) {
        <div class="description">
          <p>{{ selectedDataset.description }}</p>
        </div>
      }

      <div class="metadata">
        <div class="metadata-item">
          <div class="label">Source Type</div>
          <div class="value">{{ getSourceFlagLabel(selectedDataset.sourceType) }}</div>
        </div>
        <div class="metadata-item">
          <div class="label">Created</div>
          <div class="value">{{ formatDate(selectedDataset.createdAt) }}</div>
        </div>
        <div class="metadata-item">
          <div class="label">Modified</div>
          <div class="value">{{ formatDate(selectedDataset.modifiedAt) }}</div>
        </div>
      </div>
      
      <h3>Columns ({{ columns.length }})</h3>
      @if (columns && columns.length > 0) {
        <table>
          <thead>
            <tr>
              <th>Order</th>
              <th>Column Name</th>
              <th>Data Type</th>
            </tr>
          </thead>
          <tbody>
            @for (column of columns; track column.columnId) {
              <tr>
                <td>{{ column.columnOrder }}</td>
                <td><strong>{{ column.columnName }}</strong></td>
                <td>{{ column.dataType }}</td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <div class="empty-state">
          <p>No columns defined for this dataset.</p>
        </div>
      }

      <div class="actions">
        <button class="back-btn" (click)="backToList()">
          <mat-icon>arrow_back</mat-icon> Back to List
        </button>
        <button class="delete-btn" (click)="deleteDataset(selectedDataset.dataSetId)">
          <mat-icon>delete</mat-icon> Delete
        </button>
      </div>
    </div>
  }

  <!-- Create Form View -->
  @if (currentView === 'create') {
    <div class="create-form">
      <h2>Create New Dataset</h2>
      
      <div class="form-group">
        <label for="title">Title *</label>
        <input id="title" type="text" [(ngModel)]="newDataset.title" placeholder="Enter dataset title" />
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" [(ngModel)]="newDataset.description" placeholder="Enter description"></textarea>
      </div>

      <div class="form-group">
        <label for="sourceType">Source Type *</label>
        <select id="sourceType" [(ngModel)]="newDataset.sourceType">
          <option [value]="1">Query Builder</option>
          <option [value]="2">Inline Query</option>
          <option [value]="3">Stored Procedure</option>
        </select>
      </div>

      @if (error) {
        <div class="error">{{ error }}</div>
      }

      <div class="form-actions">
        <button class="submit-btn" (click)="createDataset()">Continue</button>
        <button class="cancel-btn" (click)="backToList()">Cancel</button>
      </div>
    </div>
  }
</div>